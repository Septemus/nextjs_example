generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model customers {
  id        String @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name      String @db.VarChar(255)
  email     String @db.VarChar(255)
  image_url String @db.VarChar(255)
}

model invoices {
  id          String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  customer_id String   @db.Uuid
  amount      Int
  status      String   @db.VarChar(255)
  date        DateTime @db.Date
}

model revenue {
  month   String @unique @db.VarChar(4)
  revenue Int
}

enum Role {
  MANUFACTURER
  DISTRIBUTOR
  CUSTOMER
}

model users {
  id             String      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name           String      @db.VarChar(255)
  email          String      @unique
  password       String
  companiesId    Int?
  role  Role    @default(CUSTOMER)
  mycompany      companies?  @relation("employment", fields: [companiesId], references: [id], onUpdate: Cascade)
  foundedCompany companies[] @relation("found")
  createdProducts products[] @relation("created_products") // ğŸ”¥åŠ è¿™è¡Œ
  ownedProducts   products[] @relation("owned_products")   // ğŸ”¥åŠ è¿™è¡Œ
}

model companies {
  id                 Int      @id @default(autoincrement())
  name               String // Company name
  physicalAddress    String // Physical address
  registrationNumber String? // Registration number (optional)
  taxId              String? // Tax ID (optional)
  founderId          String   @db.Uuid
  createdAt          DateTime @default(now())
  employees          users[]  @relation("employment")
  founder            users    @relation(fields: [founderId], references: [id], onUpdate: Cascade, name: "found")
  products           products[] @relation("company_products") // ğŸ”¥åŠ è¿™è¡Œ

}

enum ProductStatus {
  MANUFACTURING
  DISTRIBUTING
  FOR_SALE
  SOLD
}

model products {
  id                Int          @id @default(autoincrement())
  name              String       // å•†å“åç§°
  description       String?      // å•†å“æè¿°ï¼ˆå¯é€‰ï¼‰
  coverUrl          String?      // å•†å“å›¾ç‰‡é“¾æ¥ï¼ˆå¯é€‰ï¼‰
  serialNumber      String       @unique // å•†å“åºåˆ—å·ï¼ˆæ¯ä»¶å•†å“å”¯ä¸€ï¼‰
  blockchainHash    String?       @unique // åŒºå—é“¾è®°å½•çš„å“ˆå¸Œ
  manufactureDate   DateTime     // åˆ¶é€ æ—¥æœŸ
  companyId         Int          // åˆ¶é€ å…¬å¸ ID
  creatorId         String        @db.Uuid // å½•å…¥å•†å“çš„ç”Ÿäº§å•†ç”¨æˆ· ID

  currentOwnerId    String       @db.Uuid // å½“å‰æŒæœ‰è€…ç”¨æˆ· ID
  status            ProductStatus @default(MANUFACTURING) // å½“å‰å•†å“çŠ¶æ€
  createdAt         DateTime     @default(now()) //å•†å“ç™»è®°çš„æ—¥æœŸï¼Œå’Œåˆ¶é€ æ—¥æœŸä¸ä¸€æ ·

  manufacturerCompany      companies    @relation("company_products",fields: [companyId], references: [id], onUpdate: Cascade)
  creator           users         @relation("created_products", fields: [creatorId], references: [id], onUpdate: Cascade)
  currentOwner      users        @relation("owned_products",fields: [currentOwnerId], references: [id], onUpdate: Cascade)
}